// Code generated by github.com/kjkrol/goke/internal/cmd/gen/blueprints; DO NOT EDIT.
package goke

import (
    "fmt"

    "github.com/kjkrol/goke/internal/core"
)

{{ range $n := .Range }}
{{- /* File: blueprint.go.tmpl */ -}}

// Blueprint{{ $n }} defines a static template (recipe) for the mass construction 
// of entities with a predefined set of {{ $n }} stateful components. It allows 
// for precise memory layout planning before allocation, which is essential 
// for high-performance data access patterns.
//
// For example, a Blueprint{{ $n }} could be used to define complex actors that 
// require exactly {{ $n }} distinct data structures to be stored contiguously, 
// ensuring optimal data locality and cache efficiency.
type Blueprint{{ $n }}[{{ range $i := (seq 1 $n) }}T{{ $i }} any{{ if lt $i $n }}, {{ end }}{{ end }}] struct {
    blueprint *core.ArchetypeEntryBlueprint
}

// NewBlueprint{{ $n }} initializes a new template for a specific combination of {{ $n }} components.
// It accepts optional BlueprintOptions (e.g., Include[Tag]()) to extend the 
// template with any number of stateless components (Tags). Tags do not occupy 
// space in the data columns but allow for precise population filtering within Views.
//
// By using a static definition, archetype metadata is registered once, 
// enabling rapid entity spawning with minimal memory management overhead.
//
// This constructor panics if component registration fails or if there are 
// configuration conflicts, ensuring a fail-fast behavior during system initialization.
func NewBlueprint{{ $n }}[{{ range $i := (seq 1 $n) }}T{{ $i }} any{{ if lt $i $n }}, {{ end }}{{ end }}](
    ecs *ECS,
    opts ...BlueprintOption,
) *Blueprint{{ $n }}[{{ range $i := (seq 1 $n) }}T{{ $i }}{{ if lt $i $n }}, {{ end }}{{ end }}] {
    blueprint := core.NewBlueprint(ecs.registry)
    reg := ecs.registry.ComponentsRegistry

    // mustAdd ensures that component registration and blueprint assignment
    // are successful. Panics immediately on failure to support fail-fast startup.
    mustAdd := func(info core.ComponentInfo) {
        if err := blueprint.WithComp(info); err != nil {
            panic(fmt.Sprintf("goke: blueprint{{ $n }} init failed: %v", err))
        }
    }

    {{ range $i := (seq 1 $n) -}}
    mustAdd(core.EnsureComponentRegistered[T{{ $i }}](reg))
    {{ end }}

    // Apply dynamic options (Tags, Exclusions) and panic on any configuration error.
    for _, opt := range opts {
        if err := opt(blueprint); err != nil {
            panic(fmt.Sprintf("goke: blueprint{{ $n }} option failed: %v", err))
        }
    }

    return &Blueprint{{ $n }}[{{ range $i := (seq 1 $n) }}T{{ $i }}{{ if lt $i $n }}, {{ end }}{{ end }}]{
        blueprint: core.NewArchetypeEntry(blueprint),
    }
}

// Create instantiates a new entity based on the blueprint's static configuration.
// It returns the unique Entity identifier along with direct pointers to the 
// newly allocated memory for each of the {{ $n }} stateful components.
//
// The resulting entity is created with the full set of predefined Tags 
// (stateless components) configured via BlueprintOptions, making it 
// immediately discoverable by relevant Views and Filters.
//
// Example usage for Blueprint{{ $n }}:
//
//    entity, {{ range $i := (seq 1 $n) }}v{{ $i }}{{ if lt $i $n }}, {{ end }}{{ end }} := blueprint.Create()
{{- range $i := (seq 1 $n) }}
//    *v{{ $i }} = T{{ $i }}{ /* initialize */ }
{{- end }}
//
// These pointers allow for immediate initialization of the entity's state 
// without the need for additional lookups, ensuring a highly efficient 
// construction process.
func (b *Blueprint{{ $n }}[{{ range $i := (seq 1 $n) }}T{{ $i }}{{ if lt $i $n }}, {{ end }}{{ end }}]) Create() (Entity, {{ range $i := (seq 1 $n) }}*T{{ $i }}{{ if lt $i $n }}, {{ end }}{{ end }}) {
    entity, ptrs := b.blueprint.Create()
    return entity, {{ range $i := (seq 0 (sub $n 1)) }}(*T{{ add $i 1 }})(ptrs[{{ $i }}]){{ if lt (add $i 1) $n }}, {{ end }}{{ end }}
}
{{ end }}